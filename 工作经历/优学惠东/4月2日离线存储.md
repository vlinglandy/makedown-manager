## 思路

```mindmap
- 发送请求前判断网络状态，增加一个请求拦截器
  - 如果有网络正常请求
    - 如果缓存中的离线请求队列有请求则不断让存储的请求出队
    - 如果请求不为空，则让请求出队
  - 如果没有网络
    - 如果设计到修改，则向缓存设置方法和参数
    - 如果设计到删除，则向缓存设置方法和参数
    - 如果设计到增加，则像缓存中设置方法和参数
    - 如果设计到查询，则直接查询，并提示网络未连接，数据可能不全
    - 涉及到修改手机号，人身核验，等操作则提示用户联网再进行
  - 以上处理都要离线在缓存处理数据，设置一个缓存，然后向缓存拿数据
  - 或者直接判断app.js数据里有没有数据，准不准确，如果有那么就修改
  - 队列里存放对象，对象一个属性是请求方法，一个是请求参数
```

1. 首先写判断网络状态的方法
2. 然后

```mindmap
- 请求拦截器，每次请求携带一个等级1,2,3如果级别高那么就提示联网，如果级别低就离线操作
  - 如果缓存里没有东西
```

## 业务场景

```mindmap
- 刚上线就离线
  - 级别低的增删改查
    - 查（前提缓存里面有数据，此时提示用户最好联网否则数据不全）
    - 增（向缓存里增加数据，同时向请求中获取缓存请求队列，如果空则创建队列，设置缓存）
    - 改（修改缓存中对应的数据，同时向请求队列中同时向请求中获取缓存请求队列，如果空则创建队列，设置缓存）
    - 删（删除缓存中的数据，或者给缓存中的内容加个字段是否被删除，如果被删除则将字段设置为1）
  - 级别高的增删改查
    - 提示用户联网进行
```

## 业务场景一（进软件就离线）

- 刚上线就离线
  - 级别低的增删改查
    - 查（前提缓存里面有数据，此时提示用户最好联网否则数据不全）
    - 增（向缓存里增加数据，同时向请求中获取缓存请求队列，如果空则创建队列，设置缓存）
    - 改（修改缓存中对应的数据，同时向请求队列中同时向请求中获取缓存请求队列，如果空则创建队列，设置缓存）
    - 删（删除缓存中的数据，或者给缓存中的内容加个字段是否被删除，如果被删除则将字段设置为1）
  - 级别高的增删改查
    - 提示用户联网进行

## 业务场景二(一直在线)

```mindmap
- 一直在线
  - 查（查询数据，同时获取所有的数据缓存）
  - 增（插入数据，同时向缓存插入数据缓存或者再次查询所有并设置缓存）
  - 删（删除数据，同时向缓存中删除数据或者再次查询所有并设置缓存）
  - 改（修改数据，同时修改缓存中的数据或者再次查询所有并设置缓存）
  - 每次操作完成之后都向缓存中更新数据，保证数据和后台是最新的，如果不能保证的话就重新请求数据
  - 保证每次请求之后的数据都是最新的
```

## 业务场景三（长时间离线，缓存消失）

```mindmap
- 提示用户（你已经太久没有联网啦，赶快联网刷新数据吧）
```

## 业务场景四（网络时断时续）

```mindmap
- 在线时保证缓存中的数据是最新的，之后每次操作和参数记录到队列中，联网（每次页面show完成）之后进行出队请求操作（查询不用，增删改用）
  - 
```

## 业务场景五(有的操作有时效性，离线时可以，但是上线之后在请求队列中请求数据之后就不行了，此时后台返回数据会有问题)

```mindmap
- 打卡
- 签到
- 位置
```
